<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Main Client</title>
    <meta
            content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
            name="viewport"
    />
    <link
            rel="icon"
            href="assets/img/kaiadmin/favicon.ico"
            type="image/x-icon"
    />

    <!-- Fonts and icons -->
    <script src="assets/js/plugin/webfont/webfont.min.js"></script>
    <script>
        WebFont.load({
          google: { families: ["Public Sans:300,400,500,600,700"] },
          custom: {
            families: [
              "Font Awesome 5 Solid",
              "Font Awesome 5 Regular",
              "Font Awesome 5 Brands",
              "simple-line-icons",
            ],
            urls: ["assets/css/fonts.min.css"],
          },
          active: function () {
            sessionStorage.fonts = true;
          },
        });
    </script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/plugins.min.css" />
    <link rel="stylesheet" href="assets/css/kaiadmin.min.css" />

    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link rel="stylesheet" href="assets/css/demo.css" />
</head>
<body>
<div class="wrapper">

    <div th:replace="~{sidebar.html}"></div>

    <div class="main-panel">

        <div th:replace="~{header.html}"></div>

        <div class="container">
            <div class="page-inner">
                <div
                        class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4"
                >
                    <div>
                        <h3 class="fw-bold mb-3">User Management</h3>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">User List</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="user-table" class="display table table-striped table-hover dataTable">
                                <thead>
                                <tr role="row">
                                    <th>ID</th>
                                    <th>Email</th>
                                    <th>Name</th>
                                    <th>Failures</th>
                                    <th>Disabled</th>
                                    <th>Lock Status</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- 사용자 정보가 여기에 추가됩니다. -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--   Core JS Files   -->
        <script src="assets/js/core/jquery-3.7.1.min.js"></script>
        <script src="assets/js/core/popper.min.js"></script>
        <script src="assets/js/core/bootstrap.min.js"></script>

        <!-- jQuery Scrollbar -->
        <script src="assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>

        <!-- Chart JS -->
        <script src="assets/js/plugin/chart.js/chart.min.js"></script>

        <!-- jQuery Sparkline -->
        <script src="assets/js/plugin/jquery.sparkline/jquery.sparkline.min.js"></script>

        <!-- Chart Circle -->
        <script src="assets/js/plugin/chart-circle/circles.min.js"></script>

        <!-- Datatables -->
        <script src="assets/js/plugin/datatables/datatables.min.js"></script>

        <!-- Bootstrap Notify -->
        <script src="assets/js/plugin/bootstrap-notify/bootstrap-notify.min.js"></script>

        <!-- jQuery Vector Maps -->
        <script src="assets/js/plugin/jsvectormap/jsvectormap.min.js"></script>
        <script src="assets/js/plugin/jsvectormap/world.js"></script>

        <!-- Sweet Alert -->
        <script src="assets/js/plugin/sweetalert/sweetalert.min.js"></script>

        <!-- Kaiadmin JS -->
        <script src="assets/js/kaiadmin.min.js"></script>

        <!-- Kaiadmin DEMO methods, don't include it in your project! -->
        <script src="assets/js/setting-demo.js"></script>
        <script src="assets/js/demo.js"></script>
        <script>
            function getUserInfo() {
                console.log("getUserInfo 함수 호출됨");
                fetch('/api/users/getUserInfo')
                    .then(response => {
                        if (!response.ok) {
                            alert("권한이 없습니다 !!");
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("사용자 정보:", data);
                        displayUserInfo(data); // 받아온 데이터로 테이블에 사용자 정보를 추가
                    })
                    .catch(error => console.error('Error fetching user info:', error));
            }

            function displayUserInfo(users) {
                const tableBody = document.querySelector('#user-table tbody');
                tableBody.innerHTML = ''; // 기존 데이터를 초기화

                users.forEach(user => {
                    const row = document.createElement('tr');

                    row.innerHTML = `
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td>${user.firstName} ${user.lastName}</td>
                        <td>${user.bruteForceStatus.numFailures}</td>
                        <td>${user.bruteForceStatus.disabled ? 'Yes' : 'No'}</td>
                        <td>${user.bruteForceStatus.disabled ? 'Locked' : 'Unlocked'}</td>
                    `;

                    tableBody.appendChild(row);
                });
            }

            // 페이지 로드 시 getUserInfo 함수 실행
            window.onload = function() {
                if (window.location.pathname === '/user') {
                    getUserInfo();
                }
            }
        </script>
</body>
</html>
